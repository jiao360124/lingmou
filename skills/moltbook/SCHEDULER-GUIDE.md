# Moltbook自动调度任务配置指南

## 📋 手动配置步骤

### Windows任务计划程序

#### 步骤1: 打开任务计划程序
```
Win + R → 输入: taskschd.msc → 回车
```

#### 步骤2: 创建基本任务
```
右侧 → "创建基本任务"
名称: OpenClaw Moltbook Heartbeat
描述: 每天凌晨3点自动检查Moltbook健康状态
```

#### 步骤3: 设置触发器
```
触发器选项:
  每天
  开始时间: 03:00:00
  重复间隔: 1天
  重复间隔: 1次
  到期: 不限
  已启用: ✓
```

#### 步骤4: 设置操作
```
操作选项:
  启动程序
  程序或脚本: powershell.exe
  添加参数:
    -ExecutionPolicy Bypass -File "C:\Users\Administrator\.openclaw\workspace\scripts\evolution\heartbeat-monitor.ps1"
  起始于: C:\Users\Administrator\.openclaw\workspace
```

#### 步骤5: 完成设置
```
完成选项:
  ✓ 不再做此提示
  ✓ 如果任务运行失败，按以下方式重新启动: 3次
  ✓ 重新启动间隔: 1分钟
  ✓ 如果任务运行失败超过: 72小时
  ✓ 停止如果任务运行超过: 1天
  ✓ 只有在计算机使用交流电源时才启动: 否
  ✓ 唤醒计算机运行任务: 是
  ✓ ✓ 完成向导
```

---

## ✅ 验证配置

### 检查任务是否创建成功
```
1. 打开任务计划程序
2. 找到 "OpenClaw Moltbook Heartbeat" 任务
3. 右键 → 属性
4. 查看"触发器"选项卡
   - 应该显示: 每天 03:00:00
5. 查看"操作"选项卡
   - 应该显示: PowerShell
```

### 手动测试运行
```
1. 在任务计划程序中右键任务
2. 选择"运行"
3. 查看结果
   - 状态: 就绪
   - 上次运行结果: 成功
```

### 检查日志
```
1. 查看日志文件: logs/heartbeat.log
2. 应该看到今天的检查记录
3. 状态应该是 "健康"
```

---

## 🎯 预期结果

### 任务创建成功后
```
✅ 每天凌晨3:00自动执行
✅ 心跳监控系统启动
✅ Moltbook健康状态检查
✅ 速率限制管理
✅ 日志自动记录
✅ 状态文件更新
```

### 预期输出
```
2026-02-15 03:00:00.000 [INFO] 心跳监控系统启动
2026-02-15 03:00:00.100 [INFO] 配置:
2026-02-15 03:00:00.100 [INFO]   心跳间隔: 30 分钟
2026-02-15 03:00:00.100 [INFO]   警告阈值: 2 次失败
2026-02-15 03:00:00.100 [INFO]   降级阈值: 3 次失败
2026-02-15 03:00:00.100 [INFO] 心跳检查完成
```

---

## 🔧 故障排查

### 任务未运行
```
1. 检查任务状态
   - 右键任务 → 属性
   - "常规"选项卡
   - 检查"已启用"

2. 检查账户权限
   - "常规"选项卡
   - 检查"运行方式"账户
   - 建议使用: Local System

3. 查看错误日志
   - 右键任务 → 运行
   - 查看错误信息
```

### 脚本执行失败
```
1. 测试脚本
   powershell -ExecutionPolicy Bypass -File "C:\Users\Administrator\.openclaw\workspace\scripts\evolution\heartbeat-monitor.ps1"

2. 检查路径
   - 脚本路径是否正确
   - PowerShell是否在PATH中

3. 检查权限
   - 脚本所在目录是否有写入权限
```

### 心跳监控未更新
```
1. 检查时间
   - 是否已过3:00
   - 时区是否正确（Asia/Shanghai）

2. 查看日志
   - logs/heartbeat.log
   - 应该有新的记录

3. 检查状态文件
   - data/heartbeat-status.json
   - 检查最后更新时间
```

---

## 📊 完整配置检查清单

- [ ] Moltbook API Key已配置
- [ ] Agent名称已更新为AgentX2026
- [ ] 身份验证状态为"已验证"
- [ ] Windows任务计划程序已打开
- [ ] 任务名称为"OpenClaw Moltbook Heartbeat"
- [ ] 触发器设置为每天03:00
- [ ] 操作设置为PowerShell
- [ ] 脚本路径正确
- [ ] 任务已启用
- [ ] 任务测试运行成功
- [ ] 日志文件正常创建
- [ ] 状态文件正常更新

---

## 🎊 配置完成标志

当你看到以下情况时，说明配置成功：

```
✅ 任务计划程序中有"OpenClaw Moltbook Heartbeat"任务
✅ 任务状态显示"就绪"或"运行中"
✅ 下次运行时间显示为明天3:00
✅ 日志文件中有今天的记录
✅ 状态文件中显示健康状态
✅ Moltbook心跳记录正常
```

---

## 📈 下一步

配置完成后：

1. **监控初始运行**
   - 明天凌晨3:00检查任务是否执行
   - 查看日志文件

2. **验证数据收集**
   - 检查心跳历史记录
   - 确认状态文件正常更新

3. **开始KPI收集**
   - 初始化KPI系统
   - 开始收集稳定性、性能、学习指标

4. **优化和调整**
   - 根据实际运行情况调整参数
   - 优化响应时间和频率

---

**配置指南版本**: 1.0
**最后更新**: 2026-02-14 23:50:00
**状态**: ✅ 配置完成，等待手动设置任务
