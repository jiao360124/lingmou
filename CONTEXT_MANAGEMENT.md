# OpenClaw 上下文管理策略

## 问题分析
- **错误类型**: Context overflow: prompt too large for the model
- **根本原因**: 会话历史和文件内容超过了模型上下文长度限制
- **影响范围**: 无法继续进行正常对话，需要重置会话

## 立即解决方案

### 执行清理脚本
```powershell
# 运行清理脚本
cd "C:\Users\Administrator\.openclaw\workspace"
.\context_cleanup.ps1
```

### 手动清理步骤
1. **备份重要文件** - 已自动完成
2. **压缩归档项目文件** - moltbook相关文件已打包
3. **清理旧的记忆文件** - 保留最近3天的日志
4. **删除临时文件** - 清理所有 .tmp, .log, .cache 文件

## 长期预防策略

### 1. 文件管理
- **定期归档**: 每周将项目文件打包归档
- **保留策略**: 只保留最近活跃的项目文件
- **文件大小控制**: 单个文件不超过50KB

### 2. 会话管理
- **定期重置**: 每周清理一次会话历史
- **分段处理**: 大型项目分阶段处理，避免一次性加载过多文件
- **摘要记录**: 重要信息记录到MEMORY.md，不占用会话空间

### 3. 上下文优化
- **选择性加载**: 只加载当前需要的文件
- **文件分割**: 大文件分割成小部分处理
- **压缩存储**: 使用摘要和要点存储而非完整内容

### 4. 监控告警
- **文件计数监控**: 工作空间文件数量超过50个时警告
- **大小监控**: 总上下文大小超过限制时自动清理
- **定期检查**: 每日检查工作空间状态

## 执行建议

### 立即执行
1. 运行 `.\context_cleanup.ps1` 清理工作空间
2. 重启会话，创建新的干净环境
3. 验证问题是否解决

### 日常维护
1. 每天检查工作空间文件数量
2. 每周执行一次完整清理
3. 定期备份重要配置文件

## 应急预案
- 如遇严重上下文溢出，立即执行清理脚本
- 记录问题发生前的操作模式，避免重复触发
- 调整工作习惯，避免一次性处理过多大文件

---
**最后更新**: 2026-02-05
**状态**: 策略已实施，等待用户执行清理